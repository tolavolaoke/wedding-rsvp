<div ui-view="navbar"></div>

<!-- <div ng-init="guests.getSingleUser()"> -->
<div ng-controller = "GuestController as guest" ng-init="guest.getAll()">

  <div class="container">

<h2 class="guestbook-title">Admin</h2>

    <div class="row searchbar-div">
      <div class="col-xs-3 searchbar-div-child ">
        <input type="text"
               class="form-control searchbar"
               ng-model="searchBox.firstName"
               placeholder="Search Guest"/>
</div>
               <button class="btn btn-default search-icon">
                  <span class="glyphicon glyphicon-search"></span>
            </button>


          <button
            type="button"
            class="btn btn-success"
            ng-click="isAddGuestOpen = !isAddGuestOpen" ng-hide="isAddGuestOpen">
                      <i class="fa fa-plus" aria-hidden="true"></i>
            <span class="glyphicon glyphicon-user"></span>
         </button>

           <button type="button"
                   class="btn btn-default">Both
             <span class="badge">{{guest.bothEventGuestsTotal}}</span>
           </button>

            <button type="button"
                    class="btn btn-default">White
              <span class="badge">{{guest.whiteWeddingGuestsTotal}}</span>
            </button>

            <button type="button"
                    class="btn btn-default">Traditional
              <span class="badge">{{guest.traditionalGuestsTotal}}</span>
            </button>

            <button type="button"
                    class="btn btn-default">Registered
              <span class="badge">{{guest.countTotalGuests}}</span>
            </button>

            <button type="button"
                    class="btn btn-default">+ Guests
              <span class="badge">{{guest.totalExtraGuests}} </span>
            </button>

            <button type="button"
                    class="btn btn-default">Total
              <span class="badge">{{guest.countTotalGuests + guest.totalExtraGuests}}</span>
            </button>

</div>


      <i class="fa fa-window-close"
         ng-show="isAddGuestOpen"
         ng-click="isAddGuestOpen = false" >
     </i>

    <div ui-view="addGuest"
         ng-show="isAddGuestOpen"
         class="addGuest">
    </div>



      <table class="table table hover"  id="exportTable">
        <thead class="tableHead">
          <tr>
            <th>No.</th>
            <th>Names<i class="fa fa-sort"  ng-click="guest.orderBy('firstName')"></i></th>
            <th>Contact</th>

            <th>Attending Events<i class="fa fa-sort" ng-click="guest.orderBy('attendingEvents')"></i></th>
            <th>+ Guests<i class="fa fa-sort" ng-click="guest.orderBy('extraGuests')"></i></th>
            <th>Actions</th>
            <th></th>
          </tr>
        </thead>


  <tbody>


  <tr ng-repeat="person in guest.guests | filter:searchBox | orderBy: guest.headerSort track by $index"
      ng-if="$index >= guest.lower && $index < guest.upper">

      <td>{{ $index + 1 }}  </td>

      <td ng-hide="editMode" class="names" >{{ person.firstName}} {{ person.lastName}}</td>
        <td ng-show="editMode">
          <input
            type="text"
            ng-value="person.firstName"
            ng-model="guest.updatedGuest.firstName"/>

          <input
            type="text"
            ng-model="guest.updatedGuest.lastName"
            ng-value="person.lastName"/>
        </td>

        <td>
          <a ng-href="mailto:{{person.email}}" target="_top">
            <span class="glyphicon glyphicon-envelope"></span>
          </a>
            <span class="glyphicon glyphicon-phone" ng-click="isPhoneNumberShowing = !isPhoneNumberShowing">
              <p ng-show="isPhoneNumberShowing" class="admin-phonenumber">{{person.number}}</p>
            </span>
        </td>

      <td ng-hide="editMode" class="admin-attending-events">{{ person.attendingEvents}}</td>
        <td ng-show="editMode">
            <select ng-model="guest.updatedGuest.attendingEvents">
              <option
                ng-repeat="event in guest.eventOptions"
                ng-selected="event"
                ng-value="event">{{ event }}
              </option>
            </select>
        </td>


      <td ng-hide="editMode">{{ person.extraGuests}}</td>
        <td ng-show="editMode">
          <select  ng-model="guest.updatedGuest.extraGuests">
            <option value="0" ng-selected="guest.updatedGuest.extraGuests === 0">0</option>
            <option
              ng-repeat="option in guest.extraGuestsOptions"
              ng-selected="option"
              ng-value="option ">{{ option }}
            </option>
          </select>
        </td>

        <td>
          <button
            type="submit"
            class="btn btn-default"
            ng-hide="editMode"
            ng-click="editMode = true; guest.editGuest(person); guest.disableEdit()"
            ng-disabled="guest.isEditDisabled">
          <span class="glyphicon glyphicon-pencil"></span>
          </button>

          <button
            type="button"
            class="btn btn-success"
            ng-show="editMode"
            ng-click="guest.updateGuest(guest.updatedGuest)">Save
         </button>

          <button
            type="button"
            class="btn btn-danger"
            ng-show="editMode"
            ng-click="editMode = false; guest.enableEdit()">Undo
          </button>

           <button
             type="button"
             class="close"
             aria-label="Close"
             ng-hide="editMode"
             ng-click="guest.openModal(person)">
           <span aria-hidden="true">&times;</span>
          </button>
        </td>

    </tr>

  </tbody>
  </table>

          <div ng-show="guest.modalShown" class="guestbookForm">
                    <p>Are you sure you want to delete {{guest.deletingPerson.firstName}} {{guest.deletingPerson.lastName}}?</p>
                        <button
                          class="btn btn-default delete-person-button"
                          ng-click = "guest.deleteGuest(guest.deletingPerson._id)">Delete
                        </button>
                        <button
                          class="btn btn-danger delete-person-button"
                          ng-click= "guest.modalShown = false">Cancel
                      </button>
            </div>

    <div class="col-md-offset-5">
      <div
        ng-repeat="page in guest.pageNumbers"
        class="pagination-div">

            <button
              class="pagination"
              ng-click="guest.changePage(page)"
              ng-disabled="guest.upper === page * 10"
              style="width: 50px">{{ page }}
            </button>

      </div>
    </div>

 </div>
</div>
