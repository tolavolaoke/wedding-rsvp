<div ui-view="navbar"></div>

<!-- <div ng-init="guests.getSingleUser()"> -->
<div ng-controller = "GuestController as guest" ng-init="guest.getAll()">
  <div class="container">

<h2 class="guestbook-title">Admin</h2>

        <!-- <button type="button"
                name="button"
                class="btn btn-info btn-md">Guest List
                <span class="glyphicon glyphicon-resize-full"></span>
        </button> -->


    <div class="row searchbar-div">
      <div class="col-xs-6 ">
        <input type="text"
               class="form-control"
               ng-model="searchBox.firstName"
               placeholder="Search Guest"/>
      </div>
          <button
            type="button"
            class="btn btn-success"
            ng-click="isAddGuestOpen = !isAddGuestOpen" ng-hide="isAddGuestOpen"> Add Guest
         </button>
    </div>


      <i class="fa fa-window-close"
         ng-show="isAddGuestOpen"
         ng-click="isAddGuestOpen = false" >
     </i>

    <div ui-view="addGuest"
         ng-show="isAddGuestOpen"
         class="addGuest">
    </div>


      <table class="table table hover" >
        <thead class="tableHead">
          <tr>
            <th>No.</th>
            <th>Names<i class="fa fa-sort"  ng-click="guest.orderBy('firstName')"></i></th>
            <th>Contact</th>

            <th>Attending Events<i class="fa fa-sort" ng-click="guest.orderBy('attendingEvents')"></i></th>
            <th>+ Guests<i class="fa fa-sort" ng-click="guest.orderBy('extraGuests')"></i></th>
            <th>Actions</th>
            <th></th>
          </tr>
        </thead>


  <tbody>


  <tr ng-repeat="person in guest.guests | filter:searchBox | orderBy: guest.headerSort track by $index"
      ng-if="$index >= guest.lower && $index < guest.upper">

      <td>{{ $index + 1 }}  </td>

      <td ng-hide="editMode" >{{ person.firstName}} {{ person.lastName}}</td>
        <td ng-show="editMode">
          <input
            type="text"
            ng-value="person.firstName"
            ng-model="guest.updatedGuest.firstName"/>

          <input
            type="text"
            ng-model="guest.updatedGuest.lastName"
            ng-value="person.lastName"/>
        </td>

        <td>
          <a ng-href="mailto:{{person.email}}" target="_top">
            <span class="glyphicon glyphicon-envelope"></span>
          </a>
            <span class="glyphicon glyphicon-phone" ng-click="isPhoneNumberShowing = !isPhoneNumberShowing">
              <p ng-show="isPhoneNumberShowing" class="admin-phonenumber">{{person.number}}</p>
            </span>
        </td>

      <td ng-hide="editMode" class="admin-attending-events">{{ person.attendingEvents}}</td>
        <td ng-show="editMode">
            <select ng-model="guest.updatedGuest.attendingEvents">
              <option
                ng-repeat="event in guest.eventOptions"
                ng-selected="event"
                ng-value="event">{{ event }}
              </option>
            </select>
        </td>


      <td ng-hide="editMode">{{ person.extraGuests}}</td>
        <td ng-show="editMode">
          <select  ng-model="guest.updatedGuest.extraGuests">
            <option value="0" ng-selected="guest.updatedGuest.extraGuests === 0">0</option>
            <option
              ng-repeat="option in guest.extraGuestsOptions"
              ng-selected="option"
              ng-value="option ">{{ option }}
            </option>
          </select>
        </td>

        <td>
          <button
            type="submit"
            class="btn btn-default"
            ng-hide="editMode"
            ng-click="editMode = true; guest.editGuest(person); guest.disableEdit()"
            ng-disabled="guest.isEditDisabled">
          <span class="glyphicon glyphicon-pencil"></span>
          </button>

          <button
            type="button"
            class="btn btn-success"
            ng-show="editMode"
            ng-click="guest.updateGuest(guest.updatedGuest)">Save
         </button>

          <button
            type="button"
            class="btn btn-danger"
            ng-show="editMode"
            ng-click="editMode = false; guest.enableEdit()">Undo
          </button>

             <button
               type="button"
               class="close"
               aria-label="Close"
               ng-hide="editMode"
               ng-click="guest.deleteGuest(person._id)">
             <span aria-hidden="true">&times;</span>
            </button>
        </td>

    </tr>

  </tbody>
  </table>
  <div
    ng-repeat="page in guest.pageNumbers"
    style="display: inline; text-align: center">
    <button
      ng-click="guest.changePage(page)"
      ng-disabled="guest.upper === page * 10"
      style="width: 50px">{{ page }}
    </button>
  </div>


 </div>
</div>
